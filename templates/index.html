<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8">
    <title>LassSup Web - Wybór pliku</title>
    <!-- Ładujemy domyślnie ciemny motyw (Darkly) -->
    <link id="themeStylesheet" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/darkly/bootstrap.min.css">
    <!-- Dołączamy zewnętrzny plik CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <!-- Przycisk zmiany motywu -->
    <button id="themeToggle" class="btn btn-secondary">
      <span id="themeIcon">☀</span>
    </button>

    <div class="container my-4">
      <h1 class="mb-4">LassSup – Wersja Web</h1>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <!-- Ukryty input do przesyłania plików -->
          <input type="file" id="fileInput" name="file" accept=".html, .pdf">
          <!-- Przycisk otwierający okno dialogowe wyboru pliku -->
          <button type="button" id="chooseFileButton" class="btn btn-secondary">Wybierz plik</button>
          <!-- Element wyświetlający nazwę wybranego pliku -->
          <span id="fileNameDisplay" class="ml-2"></span>
        </div>
        <button type="submit" class="btn btn-primary">Wczytaj plik</button>
      </form>

      <div id="loading" class="mt-4">
        <div class="spinner-border" role="status">
          <span class="sr-only">Ładowanie...</span>
        </div>
        <span>Przetwarzanie pliku, proszę czekać...</span>
      </div>

      <div id="programData" class="mt-4">
        <!-- Miejsce, gdzie będą wyświetlane dane przetworzonego pliku -->
      </div>
    </div>

    <script>
      $(document).ready(function() {
        // Obsługa przycisku wyboru pliku
        $("#chooseFileButton").click(function(){
          $("#fileInput").click();
        });

        // Po wybraniu pliku, wyświetlamy jego nazwę
        $("#fileInput").change(function(){
          var fileName = $(this).val().split("\\").pop();
          $("#fileNameDisplay").text(fileName);
        });

        // Obsługa przesłania formularza
        $("#uploadForm").submit(function(e) {
          e.preventDefault();
          var formData = new FormData(this);
          $("#loading").show();
          $("#programData").hide();
          $.ajax({
            url: '/upload',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
              $("#loading").hide();
              $("#programData").show();
              // Tutaj możesz rozwinąć kod, aby wyświetlić dane przetworzonego pliku
            },
            error: function(xhr) {
              $("#loading").hide();
              alert("Wystąpił błąd: " + xhr.responseJSON.error);
            }
          });
        });

        // Przełącznik motywu
        var darkTheme = true; // Początkowo ciemny motyw
        $("#themeToggle").click(function(){
          if(darkTheme) {
            // Aktualnie ciemny motyw: przełączamy na jasny
            $("#themeStylesheet").attr("href", "https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/flatly/bootstrap.min.css");
            // W jasnym stylu przycisk ma wyświetlać ikonę księżyca
            $("#themeIcon").text("☾");
            darkTheme = false;
          } else {
            // Aktualnie jasny motyw: przełączamy na ciemny
            $("#themeStylesheet").attr("href", "https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/darkly/bootstrap.min.css");
            // W ciemnym stylu przycisk ma wyświetlać ikonę słoneczka
            $("#themeIcon").text("☀");
            darkTheme = true;
          }
        });
      });
    </script>
  </body>
</html>
